!function(){function e(){var e=$(this),a=e.prop("action"),t=e.find('input[name="_method"]').val()||"POST",s=e.serialize();return $.ajax({type:t,url:a,data:s}).done(function(a){if("success"==a.response)switch(e.prop("class")){case"message-form":$(".center-alert").html(a.message).fadeIn(300).delay(2500).fadeOut(300),e.find("textarea").val("");break;case"message-response-form":$(".message-response-list").prepend('<div class="row media listed-object-close"><div class="pull-left"><a href="#"><img class="media-object avatar small-avatar"src="'+userProfileImage+'" alt="'+userFirstname+'"></a></div><div class="media-body"><p><span class="text-muted">Just now you wrote:</span><a href="#"><span></span></a></p><div class="message-body">'+e.find("textarea").val()+"</div></div></div>"),e.find("textarea").val("");break;case"feed-form":{$(".feeds-count").text()}$(".feed-list").prepend('<div id="feedid" class="media listed-object"><div class="pull-left"><img class="media-object avatar medium-avatar" src="'+a.userProfileImage+'" alt="'+a.userFirstname+'"></div><div class="media-body"><h4 class="media-heading">'+a.userFirstname+"</h4><p>Just now</p>"+a.feedBody+"</div></div>"),e.find("textarea").val("")}else"failed"==a.response&&e.find("textarea").val("")}).fail(function(){return alert("something went wrong. Please try again.")}),!1}function a(){var e=$(this),a=e.attr("data-userid"),t=e.attr("href"),s=e.attr("data-method")||"POST",i=e.attr("class"),n=e.closest(".friend-request-media").find(".avatar").attr("src")||e.closest("#profile-card").find(".avatar").attr("src"),d=e.closest(".friend-request-media").find(".avatar").attr("alt")||e.closest("#profile-card").find(".avatar").attr("alt");return $.ajax({type:s,url:t,data:{userId:a}}).done(function(t){if("success"==t.response)switch(i){case"btn btn-primary friend-request-button btn-sm":e.attr("disabled","disabled").text("Request sent");break;case"btn btn-primary add-friend-button btn-sm":e.attr("disabled","disabled").text("Friend added"),$("#no-friend-chat-alert").hide(),$("#friend-list").append('<div id="friend-side-list" class="list-group"><a href="#" class="list-group-item side-list disabled" data-userid = "'+a+'"><div class="media"><div class="pull-left"><img class="media-object avatar small-avatar" src="'+n+'" alt="'+d+'"></div><div class="media-body">'+d+' <span class="glyphicon glyphicon-flash text-success"></span></div></div></a></div>');break;case"btn btn-primary add-friend-button-2 btn-sm":e.closest(".listed-object-close").slideUp(),0==t.count&&$(".users-list").append('<div class="alert alert-info" role="alert"><span class="glyphicon glyphicon-info-sign"></span> You don\'t have any friend requests.</div>');break;case"btn btn-primary unfriend-button btn-sm":e.attr("disabled","disabled").text("Removed"),0==t.count&&($("#friend-side-list").hide(),$("#friend-list").append('<div class="alert alert-info" role="alert"><span class="glyphicon glyphicon-info-sign"></span> You don\'t have any friends.</div>'));var s=$(".friends-count").text(),r=parseInt(s)-1;$(".friends-count").text(r);break;case"btn btn-primary unfriend-button-2 btn-sm":e.closest(".listed-object-close").slideUp(),0==t.count&&$(".users-list").append('<div class="alert alert-info" role="alert"><span class="glyphicon glyphicon-info-sign"></span> You don\'t have any friend requests.</div>');break;case"btn btn-primary unfriend-button-3 btn-sm":e.closest(".listed-object-close").slideUp(),0==t.count&&$(".users-list").append('<div class="alert alert-info" role="alert"><span class="glyphicon glyphicon-info-sign"></span> You don\'t have any friends.</div>');break;case"logout-link":window.location.replace("#no-friend-chat-alert".length?"/":"/")}else"failed"==t.response?$(".center-alert").html(t.message).fadeIn(300).delay(2500).fadeOut(300):alert("Something went wrong. Please try again later.")}).fail(function(){return alert("something went wrong. Please try again.")}),!1}$(".welcome-alert").fadeIn(300).delay(3500).fadeOut(300),$(".message-form").submit(e),$(".message-response-form").submit(e),$(".feed-form").submit(e),$(".friend-request-button").click(a),$(".add-friend-button-2").click(a),$(".unfriend-button-2").click(a),$(".unfriend-button-3").click(a),$(".logout-link").click(a),$(".open-message").click(function(){var e=$(this).attr("data-message-response-id"),a=1;$.ajax({type:"put",url:"/message-response",data:{openValue:a,messageResponseId:e}}).done(function(){return!1}).fail(function(){return alert("something went wrong. Please try again.")})}),$(".delete-message").click(function(){$(this).closest($(".listed-object-close")).slideUp();var e=$(this).attr("data-message-id");return $.ajax({type:"delete",url:"/message-delete",data:{messageId:e}}).done(function(e){var a=$(".message-count").text(),t=a-1;$(".message-count").text(t),0==e.count&&$(".message-list").append('<div class="alert alert-info" role="alert"><span class="glyphicon glyphicon-info-sign"></span> Your inbox is empty.</div>')}).fail(function(){return alert("something went wrong. Please try again.")}),!1}),$(".media-body").first().find($("span")).switchClass("glyphicon-chevron-down","glyphicon-chevron-up"),$(".message-body").first().css("display","block"),$(".expand-message").click(function(){return $(this).hasClass("glyphicon-chevron-down")?$(this).switchClass("glyphicon-chevron-down","glyphicon-chevron-up"):$(this).hasClass("glyphicon-chevron-up")&&$(this).switchClass("glyphicon-chevron-up","glyphicon-chevron-down"),$(this).closest(".media-body").find($(".message-body")).toggle("slide",{direction:"up"}),!1}),"http://localhost:8000/feeds"==$(location).attr("href")&&$(window).scroll(function(){if($(window).scrollTop()+$(window).height()>=$(document).height()-850?$("#go-up").show():$("#go-up").hide(),$(window).scrollTop()+$(window).height()>=$(document).height()-300){var e=$(".listed-object").length;if(10>=e&&(e=10),!(e<$(".feed-list").attr("data-feedcount")))return!1;$("#loader").fadeIn("slow",function(){$.ajax({url:"feeds/more",data:{skipQty:e}}).done(function(e){$("#loader").fadeOut("slow",function(){var a="";$.each(e.feeds,function(e,t){return 0!=$("#feedid"+t.id).length?!1:void(a+='<div id="feedid'+t.id+'" class="media listed-object"><div class="pull-left"><img class="media-object avatar medium-avatar" src="'+t.poster_profile_image+'" alt="'+t.poster_firstname+'"></div><div class="media-body"><h4 class="media-heading">'+t.poster_firstname+"</h4><p>"+$.timeago(t.created_at)+"</p>"+t.body+"</div></div>")}),$(".feed-list").append(a)})}).fail(function(){return alert("something went wrong. Please try again.")})})}}),$("body").scrollspy({target:"#go-up"})}();